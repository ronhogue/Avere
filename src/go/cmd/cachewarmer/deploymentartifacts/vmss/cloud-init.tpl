#cloud-config
#
# - bash -c "set -x && ((apt-get update && apt-get install -y nfs-common) || (sleep 10 && apt-get update && apt-get install -y nfs-common) || (sleep 10 && apt-get update && apt-get install -y nfs-common)) && mkdir -p ${bootstrap_path} && r=5 && for i in $(seq 1 $r); do mount -o 'hard,nointr,proto=tcp,mountproto=tcp,retry=30' ${bootstrap_address}:${export_path} ${bootstrap_path} && break || [ $i == $r ] && break 0 || sleep 1; done && while [ ! -f ${bootstrap_path}${bootstrap_script_path} ]; do sleep 10; done && ${env_vars} /bin/bash ${bootstrap_path}${bootstrap_script_path} 2>&1 | tee -a /var/log/bootstrap.log && umount ${bootstrap_path} && rmdir ${bootstrap_path}"
runcmd:
  - bash -c "set -x && r=5 && for i in $(seq 1 $r); do mount -o 'hard,nointr,proto=tcp,mountproto=tcp,retry=30' ${bootstrap_address}:${export_path} ${bootstrap_path} && break || [ $i == $r ] && break 0 || sleep 1; done && while [ ! -f ${bootstrap_path}${bootstrap_script_path} ]; do sleep 10; done && ${env_vars} /bin/bash ${bootstrap_path}${bootstrap_script_path} 2>&1 | tee -a /var/log/bootstrap.log && umount ${bootstrap_path} && rmdir ${bootstrap_path}"
